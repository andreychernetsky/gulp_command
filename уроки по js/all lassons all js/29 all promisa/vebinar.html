<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>
<body>

  <button id="loadFile">вебинар асихрогность таймеры промисы</button>
  <div id="result"></div>
    <!--<img src="https://lh3.googleusercontent.com/4TBHoeJxzp9_z5RGFQhxPGI4Y2NQNqmM_zoIu57bAn31FTjDK0Hj8k4Vx3zIsCZDiy76=s128;" alt="" header = "300">
    <img src="https://lh3.googleusercontent.com/Ns6JMRm3Cly&#45;&#45;qtORT9B4XZjS_G5gLRRIDKDTui7oD4KN8G01kuaumd8A2uSYQbrFpNnRw=s85;" alt="" header = "300">
    <img src="https://lh3.googleusercontent.com/f-RDnwTzbQnAwyWW-QQvnsgm4RBinnldHA_dzxbLQZUnca9NCY8MzzbhZM6YAAdXdW4V6g=s128;" alt="" header = "300">-->
    <script>
  /*setTimeout(function () {
		console.log('123');
	},3000);*/

  //	exampl
  /*
	console.log('до setTimeout');
	
	setTimeout(function() {
		console.log('123');
		},3000);
	console.log('после ');
	*/


  //разберем как работает setTimeout

  /*  const qyeue = [
	{
	  fn:function() {
	    console.log('таймер на 3000');
		},
		delay:3000,
		start:49593939
	}
];*/

  //	представим что у нас несколько таймеров
  /* console.log('до setTimeout');
	 setTimeout(function() {
		 console.log('таймер на 1000');
	 },1000);
 
	 setTimeout(function() {
		 console.log('таймер на 3000');
	 },3000);
	 console.log('после setTimeout');
 
 
 
		const qyeue = [//очередь на выполнения задач от setTimeout
	 {
		 fn:function() {
			 console.log('таймер на 3000');
		 },
		 delay:3000,
		 start:49593939
	 },
			{
			fn:function() {
		 console.log('таймер на 1000');
	 },
	 
	 
		 delay:1000,
		 start:49593939
	 }
 ];*/

  /*setTimeout(function() {
		console.log('500')
	},500);
	
	 for(let i =0 ; i < 10000000; i++) {
		let a = i / i;
	}
	console.log('после for');
 */

  //	создадим очередь из двух задач

  /*setTimeout(function () {
		console.log('timer 5000')
	},5000);
	
	setTimeout(function() {
		console.log('timer 2000');
	},2000);
	
	for(let i = 0; i < 3000000; i++) {
		let a =i / i ;
	}
	console.log('после for');*/

  //	example
  const url1 ='https://lh3.googleusercontent';
  /*const url1 ='https://lh3.googleusercontent.com/4TBHoeJxzp9_z5RGFQhxPGI4Y2NQNqmM_zoIu57bAn31FTjDK0Hj8k4Vx3zIsCZDiy76=s128';*/
  const url2 = 'https://lh3.googleusercontent.com/Ns6JMRm3Cly--qtORT9B4XZjS_G5gLRRIDKDTui7oD4KN8G01kuaumd8A2uSYQbrFpNnRw=s85';
  const url3 = 'https://lh3.googleusercontent.com/f-RDnwTzbQnAwyWW-QQvnsgm4RBinnldHA_dzxbLQZUnca9NCY8MzzbhZM6YAAdXdW4V6g=s128';

  /*const img = new Image();
	img.height = 300;
	img.src = url1;

	const img2 = new Image();
	img2.height = 300;
	img2.src = url2;
	
	const img3 = new Image();
	img3.height = 300;
	img3.src = url3;
	
	document.body.append(img);
	document.body.append(img2);
	document.body.append(img3);*/

  //  первый вариант на колбеках
  /*
	const img = new Image();
	img.heaght = 200;
	img.src = url1;
	
	img.addEventListener('load', ()=>{
		const img = new Image();
		img.heaght = 200;
		img.src = url2;
		
		document.body.append(img);
		
		img.addEventListener('load',()=>{
			const img = new Image();
			img.heaght = 200;
			img.src = url3;
			
			document.body.append(img);
			
			img.addEventListener('load', ()=> {
				console.log('все картинки загружены');
			});
		});
		
	});
		document.body.append(img);
	*/

  //  теперь на промиссах

  /*const tmp = {
		srate:['pending', 'fulfilled','rejected'],
		resolvedQueue:[//очередь загрузки определенных действий
		function(){
		console.log('1');
		},
		function(){
		console.log('2');
		},
		function(){
		console.log('3');
		},
		]
	}
	*/
  /////////////////////////////////////////

  /*	console.log('до promise');
		const promise = new Promise(function(){
			console.log('внутри promise');
		});
		console.log('после promise');*/

  /*до promise
  promis3.html:159 внутри promise
  promis3.html:161 после promise*/

  /*
	function delay(ms) {//будет создан промисс в состоянии ожидания
		return new Promise((resolve)=>{
			setTimeout(()=>{
				resolve();//resolve означает что выполнено успешно
				console.log('resolve');
			},ms)
		
		});
	}
	const promise = delay(2000);
	promise
		.then(()=> console.log(1))//добавляет функцию на исполнения
		.then(()=> console.log(2))
		.then(()=> console.log(3))
		.then(()=> console.log(4))
	
	*/

  //example

  /*function loadImage(url) {
		return new Promise((resolve)=> {
			const img = new Image();
			img.height = 200;
			img.src = url;

			document.body.append(img);
			img.addEventListener('load', () =>{
				resolve();
			});
		});
	}
	
loadImage(url2)
	.then(() => console.log('картинка 1 загружена'));
*/
  //example
  /*function loadImage(url) {
    return new Promise((resolve)=> {
      const img = new Image();
      img.height = 200;
      img.src = url;

      document.body.append(img);
      img.addEventListener('load', () =>{
        resolve();
      });
    });
  }*/

  /* loadImage(url1)
		 .then(() => {
			 console.log('картинка 1 загружена');
			 return loadImage(url1)
		 })
		 .then(()=>{
			 console.log('картинка 2 загружена');
			 return loadImage(url3)
		 })
		 .then(()=>{
			 console.log('картинка 3 загружена');
			 return loadImage(url2)
		 })
	 */
  //	переделаем через стрелочные функции
  /* loadImage(url1)
		 .then(() => loadImage(url1))
		 .then(() => loadImage(url1))
		 .then(() => loadImage(url1))
		 .then(() => loadImage(url1))
		 .then(() => console.log('картинка  загружена'));*/

  /* итого
	 у каждого промисса ест своя очередь обработки.
		 промисы можно выстраивать в цепочку и будет ждать своей очереди пока предыдущий промис не будет выполнен
		 */

  // теперь проработаем re выводит промис из состояния ожидания в вывод ошибкт
  /*
		function loadImage(url) {
			return new Promise((resolve,reject)=> {
				const img = new Image();
				img.height = 200;
				img.src = url;
				document.body.append(img);
				
				img.addEventListener('load', () =>{
					resolve();
				});
				
				img.addEventListener('error', () =>{
					reject();
				});
			});
		}*/

  /* loadImage(url2)
		 .then(() => {//первая функция выполница в случае resolve
		 console.log('ok')
		 },
			 ()=>{ //вторая функция выполница в случае reject
		 console.log('не ок')
			 });
	 */
  //  добавим cath для отлова ошибки/

  /*loadImage(url2)
		.then(()=> loadImage((url1))
		.then(()=> loadImage((url2))
		.then(()=> loadImage((url3))
		.catch(()=>{
			console.log('not ok')
		});*/

  //	example

  const loadFile = document.querySelector('#loadFile');
  const result = document.querySelector('#result');

  loadFile.addEventListener('click', ()=> {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', './text.txt');
    xhr.send();
    xhr.addEventListener('load', ()=> {
      console.log(xhr.response);
      result.innerText = xhr.response;
    });
  });

  //	перенесем его в отдельную функцию




  /*function loadFile(url) {
		return new Promise(resolve => {
			const xhr = new XMLHttpRequest();
			xhr.open('GET', url);
			xhr.send();
			xhr.addEventListener('load', ()=> {
				console.log(xhr.response);
				result.innerText = xhr.response;
				resolve(xhr.response);
			});
		})
	}
		const loadButton = document.querySelector('#loadFile');
		const result = document.querySelector('#result');
		
		loadButton.addEventListener('click', ()=> {
			loadFile('text.txt')
				.then((response) => {
					console.log('файл загружен', response);
					return respose;
				})
					.then((response) => {
					result.innerHTML = response;
					});
			});
		*/

  //example

  function delay(ms) {
    return new Promise(resolve => {
      setTimeout(() => resolve(), ms)
    });
  }
  ///////////////////////////////////////////
  /*async function fn() {
		console.log('до');
		await delay(1000);
		await delay(1000);
		await delay(1000);
		await delay(1000);
		console.log('после');*/
  ///////////////////////////////////
  /*delay(1000).then(()=> {//одно и тоже,но лучше через async
		console.log('до');
		return delay(1000);
		
	}).then(()=> {
		console.log('1');
		return delay(1000);
	})
}
fn();*/

  //	вариант с try catch
  async  function fn() {
    try {
      await delay(1000);
      await delay(1000);
      await delay(1000);
      await delay(1000);
    } catch (e) {
      console.log(e)
    }

  }
  fn();
</script>
</body>
</html>